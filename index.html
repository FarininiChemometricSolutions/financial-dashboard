<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Cashflow Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>


    <style>
        :root {
            --primary: #1E90FF;
            --secondary: #4da3ff;
            --accent: #FF6B6B;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --bg-dark: #0a0a0f;
            --bg-dark-light: #1a1a24;
            --bg-card: #2a2a3a;
            --text: #ffffff;
            --text-light: #b8bcc8;
            --border: #3a3a4a;
            --radius: 12px;
            --shadow: rgba(0, 0, 0, 0.3);
            --transition: all 0.3s ease;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-dark-light) 100%);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.5;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 25px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius);
            box-shadow: 0 8px 25px var(--shadow);
        }

        .header h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1rem;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            gap: 20px;
            min-height: calc(100vh - 200px);
            align-items: start;
        }

        .sidebar, .main-panel, .right-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar {
            position: sticky;
            top: 20px;
            height: fit-content;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }

        .widget {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .form-section {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .widget-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--border);
        }

        .widget-title {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .form-grid {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 0.9rem;
            opacity: 0.95;
        }

        .form-control {
            padding: 12px 15px;
            border: 1px solid rgba(255, 255, 255, 0.25);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 14px;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            width: 100%;
        }

        .form-control:focus {
            outline: none;
            border-color: rgba(255, 255, 255, 0.5);
            background: rgba(255, 255, 255, 0.15);
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .form-control option {
            background: var(--bg-card);
            color: var(--text);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            font-size: 14px;
            text-align: center;
            width: 100%;
        }

        .btn-primary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .btn-success { background: var(--success); color: white; }
        .btn-info { background: var(--info); color: white; }
        .btn-danger { background: var(--danger); color: white; }
        .btn-warning { background: var(--warning); color: white; }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .metrics-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .metric-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: var(--radius) var(--radius) 0 0;
        }

        .metric-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .metric-label {
            font-size: 0.85rem;
            color: var(--text-light);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .positive { color: var(--success); }
        .negative { color: var(--danger); }
        .neutral { color: var(--info); }

        .period-selector {
            display: inline-flex;
            background: var(--bg-dark-light);
            border-radius: 20px;
            padding: 3px;
        }

        .period-btn {
            padding: 6px 12px;
            border: none;
            background: none;
            border-radius: 16px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-light);
            font-size: 0.85rem;
        }

        .period-btn.active {
            background: var(--primary);
            color: white;
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        .mini-chart {
            height: 150px;
            position: relative;
        }

        .donut-chart {
            height: 250px;
            position: relative;
        }

        .transaction-item {
            background: var(--bg-dark-light);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }

        .transaction-item:hover {
            border-color: var(--primary);
            transform: translateX(3px);
        }

        .transaction-details {
            flex: 1;
        }

        .transaction-title {
            font-weight: 600;
            margin-bottom: 3px;
        }

        .transaction-meta {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .transaction-amount {
            font-weight: 700;
            font-size: 1.1rem;
            margin-right: 10px;
        }

        .delete-btn {
            padding: 4px 8px;
            font-size: 12px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .stat-card {
            padding: 12px;
            background: var(--bg-dark-light);
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 2px;
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-light);
        }

        .export-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .category-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border);
        }

        .category-item:last-child {
            border-bottom: none;
        }

        .category-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .category-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
        }

        .category-amount {
            font-weight: 600;
            font-size: 1rem;
        }

        .developer-credit {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: var(--bg-card);
            border-radius: var(--radius);
            border-top: 3px solid var(--primary);
        }

        .developer-credit h4 {
            color: var(--primary);
            margin-bottom: 5px;
        }

        .empty-state {
            text-align: center;
            color: var(--text-light);
            padding: 40px 20px;
            font-style: italic;
        }

        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        @media (max-width: 1200px) {
            .dashboard-grid {
                grid-template-columns: 280px 1fr;
            }
            .right-panel {
                order: 3;
                grid-column: 1 / -1;
                display: grid;
                grid-template-columns: repeat(3, 1fr);
                gap: 15px;
            }
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .sidebar {
                order: -1;
                position: static;
                max-height: none;
            }
            .metrics-row {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .metrics-row {
                grid-template-columns: 1fr;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Professional Cashflow Dashboard</h1>
            <p>Track your financial transactions and analyze spending patterns</p>
        </div>

        <div class="dashboard-grid">
            <div class="sidebar">
                <!-- Add Transaction Form -->
                <div class="widget form-section">
                    <div class="widget-header" style="border-color: rgba(255,255,255,0.3);">
                        <div class="widget-title">Add New Transaction</div>
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="description">Description</label>
                            <input type="text" id="description" class="form-control" placeholder="Enter transaction description">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="amount">Amount (‚Ç¨)</label>
                                <input type="number" id="amount" class="form-control" step="0.01" placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label for="type">Type</label>
                                <select id="type" class="form-control">
                                    <option value="income">Income</option>
                                    <option value="expense">Expense</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="category">Category</label>
                                <select id="category" class="form-control">
                                    <option value="salary">Salary</option>
                                    <option value="business">Business</option>
                                    <option value="investment">Investment</option>
                                    <option value="food">Food & Dining</option>
                                    <option value="transport">Transport</option>
                                    <option value="utilities">Utilities</option>
                                    <option value="entertainment">Entertainment</option>
                                    <option value="healthcare">Healthcare</option>
                                    <option value="shopping">Shopping</option>
                                    <option value="education">Education</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="date">Date</label>
                                <input type="date" id="date" class="form-control">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="addTransaction()">Add Transaction</button>
                </div>

                <!-- Quick Stats -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">Quick Stats</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalTransactions">0</div>
                            <div class="stat-label">Total Transactions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="avgDaily">‚Ç¨0</div>
                            <div class="stat-label">Avg Daily Flow</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="savingsRate">0%</div>
                            <div class="stat-label">Savings Rate</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="monthlyGrowth">0%</div>
                            <div class="stat-label">Monthly Trend</div>
                        </div>
                    </div>
                </div>

                <!-- Export Options -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">Data Management</div>
                    </div>
                    <div class="export-buttons">
                        <button class="btn btn-success" onclick="exportToCSV()">Export CSV</button>
                        <button class="btn btn-info" onclick="generatePDFReport()">Generate Report</button>
                        <button class="btn btn-primary" onclick="saveData()">Save Backup</button>
                        <button class="btn btn-info" onclick="loadData()">Load Backup</button>
                        <button class="btn btn-warning" onclick="addSampleData()">Add Sample Data</button>
                        <button class="btn btn-danger" onclick="clearAllData()">Clear All</button>
                    </div>
                </div>
            </div>

            <!-- Main Panel -->
            <div class="main-panel">
                <!-- Metrics Row -->
                <div class="metrics-row">
                    <div class="metric-card">
                        <div class="metric-value positive" id="totalIncome">‚Ç¨0</div>
                        <div class="metric-label">Total Income</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value negative" id="totalExpenses">‚Ç¨0</div>
                        <div class="metric-label">Total Expenses</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value neutral" id="netCashflow">‚Ç¨0</div>
                        <div class="metric-label">Net Cashflow</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value neutral" id="currentBalance">‚Ç¨0</div>
                        <div class="metric-label">Current Balance</div>
                    </div>
                </div>

                <!-- Period Selector -->
                <div style="margin-bottom: 20px; text-align: center;">
                    <div class="period-selector">
                        <button class="period-btn" data-period="week">Week</button>
                        <button class="period-btn active" data-period="month">Month</button>
                        <button class="period-btn" data-period="quarter">Quarter</button>
                        <button class="period-btn" data-period="year">Year</button>
                        <button class="period-btn" data-period="all">All</button>
                    </div>
                </div>

                <!-- Main Chart -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">Cashflow Trend Analysis</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="mainCashflowChart"></canvas>
                    </div>
                </div>

                <!-- Secondary Charts -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="widget">
                        <div class="widget-header">
                            <div class="widget-title">Income vs Expenses</div>
                        </div>
                        <div class="mini-chart">
                            <canvas id="incomeExpenseChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="widget">
                        <div class="widget-header">
                            <div class="widget-title">Monthly Balance</div>
                        </div>
                        <div class="mini-chart">
                            <canvas id="balanceChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recent Transactions -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">Recent Transactions</div>
                    </div>
                    <div id="transactionsList" style="max-height: 300px; overflow-y: auto;">
                        <div class="empty-state">
                            <div class="icon">üìä</div>
                            <p>No transactions yet.<br>Add your first transaction to get started.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel -->
            <div class="right-panel">
                <!-- Category Breakdown Chart -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">Expense Categories</div>
                    </div>
                    <div class="donut-chart">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>

                <!-- Category List -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">Category Breakdown</div>
                    </div>
                    <div class="category-list" id="categoryList">
                        <div class="empty-state">
                            <div class="icon">üè∑Ô∏è</div>
                            <p>No expense categories yet.<br>Add some expenses to see the breakdown.</p>
                        </div>
                    </div>
                </div>

                <!-- Financial Summary -->
                <div class="widget">
                    <div class="widget-header">
                        <div class="widget-title">Financial Summary</div>
                    </div>
                    <div style="padding: 20px;">
                        <div style="text-align: center; margin-bottom: 20px;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--text-light); margin-bottom: 10px;" id="financialGrade">-</div>
                            <div style="font-size: 1rem; color: var(--text-light); margin-bottom: 15px;" id="financialStatus">Start tracking to see insights</div>
                        </div>
                        <div style="background: var(--bg-dark-light); height: 8px; border-radius: 4px; margin: 15px 0;">
                            <div id="healthBar" style="background: var(--info); height: 100%; width: 0%; border-radius: 4px; transition: width 1s ease;"></div>
                        </div>
                        <div style="font-size: 0.9rem; color: var(--text-light); text-align: center;" id="healthScore">Score: 0/100</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Developer Credit -->
        <div class="developer-credit">
            <h4>Developed by:</h4>
            <p><strong>Dr. Emanuele Farinini, PhD</strong></p>
            <p style="font-style: italic; color: var(--text-light);">Chemometric Consultant</p>
            <p style="margin-top: 8px;">
                <a href="https://chemometricsolutions.com" target="_blank" 
                   style="color: var(--primary); text-decoration: none; font-weight: 500;">
                    chemometricsolutions.com
                </a>
            </p>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="fileInput" accept=".json" style="display: none;">

    <script>
        // Global variables
        let transactions = [];
        let nextId = 1;
        let currentPeriod = 'month';
        let charts = {};

        // Utility functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-EU', {
                style: 'currency',
                currency: 'EUR'
            }).format(amount);
        }

        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }

        function getCategoryIcon(category) {
            const icons = {
                salary: 'üí∞', business: 'üíº', investment: 'üìà',
                food: 'üçΩÔ∏è', transport: 'üöó', utilities: '‚ö°',
                entertainment: 'üé¨', healthcare: 'üè•', shopping: 'üõí',
                education: 'üìö', other: 'üìä'
            };
            return icons[category] || 'üìä';
        }

        // Calculate financial health score
        function calculateFinancialHealth() {
            if (transactions.length === 0) return { score: 0, grade: '-', status: 'Start tracking to see insights' };
            
            const income = transactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
            const expenses = Math.abs(transactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0));
            
            if (income === 0) return { score: 0, grade: 'F', status: 'No income recorded' };
            
            const savingsRate = ((income - expenses) / income) * 100;
            let score = Math.max(0, Math.min(100, savingsRate + 50)); // Base score with adjustments
            let grade, status;
            
            if (score >= 80) { grade = 'A'; status = 'Excellent financial health'; }
            else if (score >= 70) { grade = 'B'; status = 'Good financial management'; }
            else if (score >= 60) { grade = 'C'; status = 'Decent financial position'; }
            else if (score >= 40) { grade = 'D'; status = 'Needs improvement'; }
            else { grade = 'F'; status = 'Critical financial situation'; }
            
            return { score: Math.round(score), grade, status };
        }

        // Update main metrics
        function updateMetrics() {
            const filteredTransactions = getFilteredTransactions();
            
            const income = filteredTransactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
            const expenses = Math.abs(filteredTransactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0));
            const netCashflow = income - expenses;
            const currentBalance = transactions.reduce((sum, t) => sum + t.amount, 0);

            document.getElementById('totalIncome').textContent = formatCurrency(income);
            document.getElementById('totalExpenses').textContent = formatCurrency(expenses);
            document.getElementById('netCashflow').textContent = formatCurrency(netCashflow);
            document.getElementById('currentBalance').textContent = formatCurrency(currentBalance);

            // Update quick stats
            document.getElementById('totalTransactions').textContent = transactions.length;
            
            const avgDaily = transactions.length > 0 ? netCashflow / 30 : 0;
            document.getElementById('avgDaily').textContent = formatCurrency(avgDaily);
            
            const savingsRate = income > 0 ? ((income - expenses) / income * 100).toFixed(1) : 0;
            document.getElementById('savingsRate').textContent = savingsRate + '%';
            
            // Calculate trend (simplified)
            const trend = netCashflow > 0 ? '+' + ((netCashflow / (expenses || 1)) * 100).toFixed(1) : '0';
            document.getElementById('monthlyGrowth').textContent = trend + '%';

            // Update net cashflow color
            const netElement = document.getElementById('netCashflow');
            const balanceElement = document.getElementById('currentBalance');
            
            netElement.className = netCashflow > 0 ? 'metric-value positive' : 
                                   netCashflow < 0 ? 'metric-value negative' : 'metric-value neutral';
            
            balanceElement.className = currentBalance > 0 ? 'metric-value positive' : 
                                       currentBalance < 0 ? 'metric-value negative' : 'metric-value neutral';
        }

        // Update transactions list
        function updateTransactionsList() {
            const container = document.getElementById('transactionsList');
            
            if (transactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üìä</div>
                        <p>No transactions yet.<br>Add your first transaction to get started.</p>
                    </div>
                `;
                return;
            }
            
            const sortedTransactions = [...transactions]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10);

            container.innerHTML = sortedTransactions.map(transaction => `
                <div class="transaction-item">
                    <div class="transaction-details">
                        <div class="transaction-title">${transaction.description}</div>
                        <div class="transaction-meta">
                            ${transaction.date} ‚Ä¢ ${capitalizeFirst(transaction.category)}
                        </div>
                    </div>
                    <div class="transaction-amount ${transaction.amount > 0 ? 'positive' : 'negative'}">
                        ${formatCurrency(Math.abs(transaction.amount))}
                    </div>
                    <button class="delete-btn" onclick="deleteTransaction(${transaction.id})">√ó</button>
                </div>
            `).join('');
        }

        // Update category list
        function updateCategoryList() {
            const container = document.getElementById('categoryList');
            const categoryTotals = {};
            const categoryColors = {
                salary: '#3498db', business: '#e74c3c', investment: '#2ecc71',
                food: '#f39c12', transport: '#9b59b6', utilities: '#1abc9c',
                entertainment: '#e67e22', healthcare: '#34495e', shopping: '#e91e63',
                education: '#795548', other: '#607d8b'
            };

            const expenseTransactions = transactions.filter(t => t.amount < 0);
            
            if (expenseTransactions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üè∑Ô∏è</div>
                        <p>No expense categories yet.<br>Add some expenses to see the breakdown.</p>
                    </div>
                `;
                return;
            }

            expenseTransactions.forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + Math.abs(t.amount);
            });

            const sortedCategories = Object.entries(categoryTotals)
                .sort(([,a], [,b]) => b - a);

            container.innerHTML = sortedCategories.map(([category, amount]) => `
                <div class="category-item">
                    <div class="category-info">
                        <div class="category-icon" style="background: ${categoryColors[category] || '#6c757d'};">
                            ${getCategoryIcon(category)}
                        </div>
                        <span>${capitalizeFirst(category)}</span>
                    </div>
                    <div class="category-amount">${formatCurrency(amount)}</div>
                </div>
            `).join('');
        }

        // Update financial health display
        function updateFinancialHealth() {
            const health = calculateFinancialHealth();
            
            document.getElementById('financialGrade').textContent = health.grade;
            document.getElementById('financialStatus').textContent = health.status;
            document.getElementById('healthScore').textContent = `Score: ${health.score}/100`;
            document.getElementById('healthBar').style.width = `${health.score}%`;
            
            // Update color based on score
            const healthBar = document.getElementById('healthBar');
            const gradeElement = document.getElementById('financialGrade');
            
            if (health.score >= 80) {
                healthBar.style.background = 'var(--success)';
                gradeElement.style.color = 'var(--success)';
            } else if (health.score >= 60) {
                healthBar.style.background = 'var(--warning)';
                gradeElement.style.color = 'var(--warning)';
            } else {
                healthBar.style.background = 'var(--danger)';
                gradeElement.style.color = 'var(--danger)';
            }
        }

        // Get monthly data from real transactions
        // Get monthly data from real transactions
        function getMonthlyDataFromTransactions() {
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const monthlyIncome = new Array(12).fill(0);
            const monthlyExpenses = new Array(12).fill(0);

            transactions.forEach(t => {
                const date = new Date(t.date);
                const monthIndex = date.getMonth(); // 0-11 for Jan-Dec

                if (t.amount > 0) {
                    monthlyIncome[monthIndex] += t.amount;
                } else {
                    monthlyExpenses[monthIndex] += Math.abs(t.amount);
                }
            });

            return {
                months,
                income: monthlyIncome,
                expenses: monthlyExpenses,
                netCashflow: monthlyIncome.map((income, i) => income - monthlyExpenses[i])
            };
        }


        // Initialize charts
        function initCharts() {
            // Main cashflow chart
            const mainCtx = document.getElementById('mainCashflowChart').getContext('2d');
            charts.main = new Chart(mainCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Income',
                        data: new Array(12).fill(0),
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Expenses',
                        data: new Array(12).fill(0),
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.1)',
                        fill: true,
                        tension: 0.4
                    }, {
                        label: 'Net Flow',
                        data: new Array(12).fill(0),
                        borderColor: '#1E90FF',
                        backgroundColor: 'rgba(30, 144, 255, 0.1)',
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            labels: { color: '#ffffff' }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#b8bcc8' },
                            grid: { color: '#3a3a4a' }
                        },
                        y: {
                            ticks: {
                                color: '#b8bcc8',
                                callback: function(value) {
                                    return '‚Ç¨' + value.toLocaleString();
                                }
                            },
                            grid: { color: '#3a3a4a' }
                        }
                    }
                }
            });

            // Income vs Expense Chart
            const incomeExpenseCtx = document.getElementById('incomeExpenseChart').getContext('2d');
            charts.incomeExpense = new Chart(incomeExpenseCtx, {
                type: 'bar',
                data: {
                    labels: ['Income', 'Expenses'],
                    datasets: [{
                        data: [0, 0],
                        backgroundColor: ['#28a745', '#dc3545']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#b8bcc8' },
                            grid: { color: '#3a3a4a' }
                        },
                        y: {
                            ticks: {
                                color: '#b8bcc8',
                                callback: function(value) {
                                    return '‚Ç¨' + (value/1000).toFixed(0) + 'k';
                                }
                            },
                            grid: { color: '#3a3a4a' }
                        }
                    }
                }
            });

            // Category Chart
            const categoryCtx = document.getElementById('categoryChart').getContext('2d');
            charts.category = new Chart(categoryCtx, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            '#dc3545', '#ffc107', '#28a745', '#17a2b8',
                            '#6f42c1', '#fd7e14', '#20c997', '#6c757d',
                            '#e83e8c', '#495057'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#ffffff', padding: 15 }
                        }
                    }
                }
            });

            // Balance Chart
            const balanceCtx = document.getElementById('balanceChart').getContext('2d');
            charts.balance = new Chart(balanceCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        data: new Array(12).fill(0),
                        borderColor: '#1E90FF',
                        backgroundColor: 'rgba(30, 144, 255, 0.1)',
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#1E90FF'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#b8bcc8' },
                            grid: { color: '#3a3a4a' }
                        },
                        y: {
                            ticks: {
                                color: '#b8bcc8',
                                callback: function(value) {
                                    return '‚Ç¨' + (value/1000).toFixed(0) + 'k';
                                }
                            },
                            grid: { color: '#3a3a4a' }
                        }
                    }
                }
            });
        }

        // Update all charts
        function updateCharts() {
            if (!charts.main) return;

            const monthlyData = getMonthlyDataFromTransactions();
            
            // Update main chart
            charts.main.data.datasets[0].data = monthlyData.income;
            charts.main.data.datasets[1].data = monthlyData.expenses;
            charts.main.data.datasets[2].data = monthlyData.netCashflow;
            charts.main.update();

            // Update income vs expense chart
            const income = transactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
            const expenses = Math.abs(transactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0));
            
            charts.incomeExpense.data.datasets[0].data = [income, expenses];
            charts.incomeExpense.update();

            // Update category chart
            const categoryTotals = {};
            transactions.filter(t => t.amount < 0).forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + Math.abs(t.amount);
            });

            charts.category.data.labels = Object.keys(categoryTotals).map(capitalizeFirst);
            charts.category.data.datasets[0].data = Object.values(categoryTotals);
            charts.category.update();

            // Update balance chart (running balance over time)
            // Update balance chart (running balance over time)
            let runningBalance = 0;
            const balanceData = new Array(12).fill(0);

            if (transactions.length > 0) {
                const sortedTransactions = [...transactions].sort((a, b) => new Date(a.date) - new Date(b.date));
                
                // Calculate cumulative balance for each month
                const monthlyBalances = new Array(12).fill(0);
                let currentBalance = 0;
                
                sortedTransactions.forEach(t => {
                    currentBalance += t.amount;
                    const date = new Date(t.date);
                    const monthIndex = date.getMonth(); // 0-11 for Jan-Dec
                    monthlyBalances[monthIndex] = currentBalance;
                });
                
                // Forward fill the balance data to show cumulative effect
                let lastBalance = 0;
                for (let i = 0; i < 12; i++) {
                    if (monthlyBalances[i] !== 0) {
                        lastBalance = monthlyBalances[i];
                    }
                    balanceData[i] = lastBalance;
                }
            }
            
            charts.balance.data.datasets[0].data = balanceData;
            charts.balance.update();
        }

        // Get filtered transactions based on period
        function getFilteredTransactions() {
            const now = new Date();
            const startDate = new Date();

            switch(currentPeriod) {
                case 'week':
                    startDate.setDate(now.getDate() - 7);
                    break;
                case 'month':
                    startDate.setMonth(now.getMonth() - 1);
                    break;
                case 'quarter':
                    startDate.setMonth(now.getMonth() - 3);
                    break;
                case 'year':
                    startDate.setFullYear(now.getFullYear() - 1);
                    break;
                case 'all':
                default:
                    return transactions;
            }

            return transactions.filter(t => new Date(t.date) >= startDate);
        }

        // Add transaction
        function addTransaction() {
            const description = document.getElementById('description').value.trim();
            const amount = parseFloat(document.getElementById('amount').value);
            const type = document.getElementById('type').value;
            const category = document.getElementById('category').value;
            const date = document.getElementById('date').value;

            if (!description || !amount || amount <= 0) {
                alert('Please enter a valid description and amount');
                return;
            }

            const transaction = {
                id: nextId++,
                description,
                amount: type === 'expense' ? -amount : amount,
                type,
                category,
                date: date || new Date().toISOString().split('T')[0],
                timestamp: new Date().toISOString()
            };

            transactions.push(transaction);

            // Clear form
            document.getElementById('description').value = '';
            document.getElementById('amount').value = '';

            updateAll();
            saveToLocalStorage();
        }

        // Delete transaction
        function deleteTransaction(id) {
            if (confirm('Are you sure you want to delete this transaction?')) {
                transactions = transactions.filter(t => t.id !== id);
                updateAll();
                saveToLocalStorage();
            }
        }

        // Update everything
        function updateAll() {
            updateMetrics();
            updateTransactionsList();
            updateCategoryList();
            updateFinancialHealth();
            updateCharts();
        }

        // Local storage functions
        function saveToLocalStorage() {
            try {
                localStorage.setItem('cashflow_transactions', JSON.stringify({
                    transactions,
                    nextId,
                    lastSaved: new Date().toISOString()
                }));
            } catch (error) {
                console.error('Error saving to localStorage:', error);
            }
        }

        function loadFromLocalStorage() {
            try {
                const saved = localStorage.getItem('cashflow_transactions');
                if (saved) {
                    const data = JSON.parse(saved);
                    transactions = data.transactions || [];
                    nextId = data.nextId || 1;
                    return true;
                }
            } catch (error) {
                console.error('Error loading from localStorage:', error);
            }
            return false;
        }

        // Export functions
        function exportToCSV() {
            if (transactions.length === 0) {
                alert('No transactions to export');
                return;
            }
            
            const csvData = [['Date', 'Description', 'Type', 'Category', 'Amount (EUR)']];
            transactions.forEach(t => {
                csvData.push([t.date, t.description, t.type, t.category, t.amount]);
            });

            const csvContent = csvData.map(row => row.join(',')).join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cashflow-export-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function generatePDFReport() {
            if (transactions.length === 0) {
                alert('No transactions to generate report from');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Header
            doc.setFontSize(20);
            doc.setTextColor(30, 144, 255);
            doc.text('Cashflow Financial Report', 20, 20);
            
            doc.setFontSize(12);
            doc.setTextColor(100, 100, 100);
            doc.text(`Generated on: ${new Date().toLocaleDateString('en-EU')}`, 20, 30);
            doc.text(`Report Period: ${currentPeriod.charAt(0).toUpperCase() + currentPeriod.slice(1)}`, 20, 37);
            
            // Line separator
            doc.setDrawColor(200, 200, 200);
            doc.line(20, 45, 190, 45);
            
            // Financial Summary
            doc.setFontSize(16);
            doc.setTextColor(0, 0, 0);
            doc.text('Financial Summary', 20, 55);
            
            const filteredTransactions = getFilteredTransactions();
            const income = filteredTransactions.filter(t => t.amount > 0).reduce((sum, t) => sum + t.amount, 0);
            const expenses = Math.abs(filteredTransactions.filter(t => t.amount < 0).reduce((sum, t) => sum + t.amount, 0));
            const netCashflow = income - expenses;
            const currentBalance = transactions.reduce((sum, t) => sum + t.amount, 0);
            
            doc.setFontSize(11);
            let yPos = 65;
            
            // Key Metrics
            doc.setTextColor(40, 167, 69);
            doc.text(`Total Income: ${formatCurrency(income)}`, 20, yPos);
            doc.setTextColor(220, 53, 69);
            doc.text(`Total Expenses: ${formatCurrency(expenses)}`, 105, yPos);
            
            yPos += 8;
            doc.setTextColor(netCashflow >= 0 ? 40 : 220, netCashflow >= 0 ? 167 : 53, netCashflow >= 0 ? 69 : 69);
            doc.text(`Net Cashflow: ${formatCurrency(netCashflow)}`, 20, yPos);
            doc.setTextColor(currentBalance >= 0 ? 40 : 220, currentBalance >= 0 ? 167 : 53, currentBalance >= 0 ? 69 : 69);
            doc.text(`Current Balance: ${formatCurrency(currentBalance)}`, 105, yPos);
            
            // Financial Health
            const health = calculateFinancialHealth();
            yPos += 15;
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text('Financial Health Assessment', 20, yPos);
            
            yPos += 10;
            doc.setFontSize(11);
            const healthColor = health.score >= 80 ? [40, 167, 69] : health.score >= 60 ? [255, 193, 7] : [220, 53, 69];
            doc.setTextColor(healthColor[0], healthColor[1], healthColor[2]);
            doc.text(`Grade: ${health.grade} (${health.score}/100)`, 20, yPos);
            doc.setTextColor(100, 100, 100);
            doc.text(`Status: ${health.status}`, 20, yPos + 7);
            
            // Category Breakdown
            yPos += 20;
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text('Expense Categories', 20, yPos);
            
            const categoryTotals = {};
            filteredTransactions.filter(t => t.amount < 0).forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + Math.abs(t.amount);
            });
            
            const sortedCategories = Object.entries(categoryTotals)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 8); // Top 8 categories
            
            yPos += 10;
            doc.setFontSize(10);
            sortedCategories.forEach(([category, amount], index) => {
                const percentage = expenses > 0 ? ((amount / expenses) * 100).toFixed(1) : 0;
                doc.setTextColor(0, 0, 0);
                doc.text(`${capitalizeFirst(category)}:`, 25, yPos);
                doc.text(`${formatCurrency(amount)} (${percentage}%)`, 85, yPos);
                yPos += 6;
            });
            
            // Recent Transactions Section
            if (yPos > 200) {
                doc.addPage();
                yPos = 20;
            } else {
                yPos += 15;
            }
            
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text('Recent Transactions', 20, yPos);
            
            const recentTransactions = [...filteredTransactions]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 15);
            
            yPos += 10;
            doc.setFontSize(9);
            
            // Table header
            doc.setTextColor(100, 100, 100);
            doc.text('Date', 20, yPos);
            doc.text('Description', 45, yPos);
            doc.text('Category', 110, yPos);
            doc.text('Amount', 150, yPos);
            yPos += 5;
            
            // Table content
            recentTransactions.forEach((transaction, index) => {
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                }
                
                doc.setTextColor(0, 0, 0);
                doc.text(transaction.date, 20, yPos);
                
                // Truncate description if too long
                let description = transaction.description;
                if (description.length > 25) {
                    description = description.substring(0, 22) + '...';
                }
                doc.text(description, 45, yPos);
                doc.text(capitalizeFirst(transaction.category), 110, yPos);
                
                // Amount with color
                const amountColor = transaction.amount >= 0 ? [40, 167, 69] : [220, 53, 69];
                doc.setTextColor(amountColor[0], amountColor[1], amountColor[2]);
                doc.text(formatCurrency(Math.abs(transaction.amount)), 150, yPos);
                
                yPos += 6;
            });
            
            // Monthly Analysis
            if (yPos > 200) {
                doc.addPage();
                yPos = 20;
            } else {
                yPos += 20;
            }
            
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text('Monthly Analysis', 20, yPos);
            
            const monthlyData = getMonthlyDataFromTransactions();
            yPos += 10;
            doc.setFontSize(10);
            
            // Monthly summary table
            doc.setTextColor(100, 100, 100);
            doc.text('Month', 20, yPos);
            doc.text('Income', 50, yPos);
            doc.text('Expenses', 85, yPos);
            doc.text('Net Flow', 125, yPos);
            doc.text('Balance', 160, yPos);
            yPos += 5;
            
            let runningBalance = 0;
            monthlyData.months.forEach((month, index) => {
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                }
                
                runningBalance += monthlyData.netCashflow[index];
                
                doc.setTextColor(0, 0, 0);
                doc.text(month, 20, yPos);
                
                doc.setTextColor(40, 167, 69);
                doc.text(`‚Ç¨${monthlyData.income[index].toFixed(0)}`, 50, yPos);
                
                doc.setTextColor(220, 53, 69);
                doc.text(`‚Ç¨${monthlyData.expenses[index].toFixed(0)}`, 85, yPos);
                
                const netFlow = monthlyData.netCashflow[index];
                doc.setTextColor(netFlow >= 0 ? 40 : 220, netFlow >= 0 ? 167 : 53, netFlow >= 0 ? 69 : 69);
                doc.text(`‚Ç¨${netFlow.toFixed(0)}`, 125, yPos);
                
                doc.setTextColor(runningBalance >= 0 ? 40 : 220, runningBalance >= 0 ? 167 : 53, runningBalance >= 0 ? 69 : 69);
                doc.text(`‚Ç¨${runningBalance.toFixed(0)}`, 160, yPos);
                
                yPos += 6;
            });
            
            // Insights and Recommendations
            if (yPos > 220) {
                doc.addPage();
                yPos = 20;
            } else {
                yPos += 20;
            }
            
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text('Financial Insights & Recommendations', 20, yPos);
            
            yPos += 10;
            doc.setFontSize(10);
            doc.setTextColor(60, 60, 60);
            
            // Generate insights based on data
            const savingsRate = income > 0 ? ((income - expenses) / income * 100) : 0;
            const insights = [];
            
            if (savingsRate > 20) {
                insights.push('‚úì Excellent savings rate! You\'re saving more than 20% of your income.');
            } else if (savingsRate > 10) {
                insights.push('+ Good savings rate. Consider increasing to 20% for optimal financial health.');
            } else if (savingsRate > 0) {
                insights.push('! Low savings rate. Try to reduce expenses or increase income.');
            } else {
                insights.push('‚ö† Negative savings rate. Immediate action needed to balance finances.');
            }
            
            if (Object.keys(categoryTotals).length > 0) {
                const topCategory = Object.entries(categoryTotals).sort(([,a], [,b]) => b - a)[0];
                const topCategoryPercentage = (topCategory[1] / expenses * 100).toFixed(1);
                insights.push(`‚Ä¢ Your highest expense category is ${capitalizeFirst(topCategory[0])} (${topCategoryPercentage}%)`);
                
                if (topCategoryPercentage > 40) {
                    insights.push(`‚ö† ${capitalizeFirst(topCategory[0])} expenses are very high. Consider optimization.`);
                }
            }
            
            const avgMonthlyExpenses = expenses / Math.max(1, filteredTransactions.filter(t => t.amount < 0).length / 30);
            if (avgMonthlyExpenses > income * 0.8) {
                insights.push('! Monthly expenses are high relative to income. Budget review recommended.');
            }
            
            insights.forEach(insight => {
                if (yPos > 270) {
                    doc.addPage();
                    yPos = 20;
                }
                
                // Wrap text for long insights
                const lines = doc.splitTextToSize(insight, 170);
                lines.forEach(line => {
                    doc.text(line, 20, yPos);
                    yPos += 5;
                });
                yPos += 2;
            });
            
            // Footer
            const pageCount = doc.internal.getNumberOfPages();
            for (let i = 1; i <= pageCount; i++) {
                doc.setPage(i);
                doc.setFontSize(8);
                doc.setTextColor(150, 150, 150);
                doc.text(`Page ${i} of ${pageCount}`, 20, 290);
                doc.text('Generated by Professional Cashflow Dashboard', 105, 290);
                doc.text(`Dr. Emanuele Farinini, PhD - chemometricsolutions.com`, 20, 285);
            }
            
            // Save the PDF
            const filename = `cashflow-report-${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(filename);
            
            // Show success message
            alert(`PDF report generated successfully!\nFile: ${filename}\n\nThe report includes:\n‚Ä¢ Financial summary\n‚Ä¢ Health assessment\n‚Ä¢ Category breakdown\n‚Ä¢ Transaction history\n‚Ä¢ Monthly analysis\n‚Ä¢ Personalized insights`);
        }

        function saveData() {
            if (transactions.length === 0) {
                alert('No data to save');
                return;
            }
            
            const dataToSave = { 
                transactions, 
                nextId, 
                exportDate: new Date().toISOString(),
                version: "1.0"
            };
            
            const blob = new Blob([JSON.stringify(dataToSave, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `cashflow-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        function loadData() {
            document.getElementById('fileInput').click();
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete all transactions? This action cannot be undone.')) {
                transactions = [];
                nextId = 1;
                updateAll();
                saveToLocalStorage();
                alert('All data cleared successfully');
            }
        }
        // Add sample data for testing
        function addSampleData() {
            if (transactions.length > 0) {
                if (!confirm('This will add sample data to your existing transactions. Continue?')) {
                    return;
                }
            }

            const sampleTransactions = [
                // Gennaio
                { description: 'Stipendio Gennaio', amount: 3500, type: 'income', category: 'salary', date: '2025-01-01' },
                { description: 'Affitto', amount: -800, type: 'expense', category: 'utilities', date: '2025-01-02' },
                { description: 'Spesa alimentari', amount: -120, type: 'expense', category: 'food', date: '2025-01-05' },
                { description: 'Benzina', amount: -60, type: 'expense', category: 'transport', date: '2025-01-08' },
                
                // Febbraio
                { description: 'Stipendio Febbraio', amount: 3500, type: 'income', category: 'salary', date: '2025-02-01' },
                { description: 'Bolletta elettricit√†', amount: -90, type: 'expense', category: 'utilities', date: '2025-02-03' },
                { description: 'Cena fuori', amount: -45, type: 'expense', category: 'entertainment', date: '2025-02-14' },
                { description: 'Freelance lavoro', amount: 800, type: 'income', category: 'business', date: '2025-02-20' },
                
                // Marzo
                { description: 'Stipendio Marzo', amount: 3500, type: 'income', category: 'salary', date: '2025-03-01' },
                { description: 'Spesa settimanale', amount: -110, type: 'expense', category: 'food', date: '2025-03-07' },
                { description: 'Palestra', amount: -50, type: 'expense', category: 'healthcare', date: '2025-03-10' },
                { description: 'Shopping vestiti', amount: -200, type: 'expense', category: 'shopping', date: '2025-03-15' },
                
                // Aprile
                { description: 'Stipendio Aprile', amount: 3500, type: 'income', category: 'salary', date: '2025-04-01' },
                { description: 'Assicurazione auto', amount: -300, type: 'expense', category: 'transport', date: '2025-04-05' },
                { description: 'Investimenti', amount: 1200, type: 'income', category: 'investment', date: '2025-04-12' },
                { description: 'Ristorante', amount: -80, type: 'expense', category: 'food', date: '2025-04-18' },
                
                // Maggio
                { description: 'Stipendio Maggio', amount: 3500, type: 'income', category: 'salary', date: '2025-05-01' },
                { description: 'Vacanza weekend', amount: -400, type: 'expense', category: 'entertainment', date: '2025-05-15' },
                { description: 'Corso online', amount: -150, type: 'expense', category: 'education', date: '2025-05-20' },
                { description: 'Rimborso spese', amount: 250, type: 'income', category: 'other', date: '2025-05-25' },
                
                // Giugno
                { description: 'Stipendio Giugno', amount: 3500, type: 'income', category: 'salary', date: '2025-06-01' },
                { description: 'Riparazione auto', amount: -350, type: 'expense', category: 'transport', date: '2025-06-08' },
                { description: 'Spesa grande', amount: -180, type: 'expense', category: 'food', date: '2025-06-12' },
                { description: 'Bonus lavoro', amount: 500, type: 'income', category: 'business', date: '2025-06-30' },
                
                // Luglio
                { description: 'Stipendio Luglio', amount: 3500, type: 'income', category: 'salary', date: '2025-07-01' },
                { description: 'Vacanze estive', amount: -1200, type: 'expense', category: 'entertainment', date: '2025-07-15' },
                { description: 'Elettrodomestico', amount: -400, type: 'expense', category: 'shopping', date: '2025-07-20' },
                
                // Agosto
                { description: 'Stipendio Agosto', amount: 3500, type: 'income', category: 'salary', date: '2025-08-01' },
                { description: 'Spese mediche', amount: -200, type: 'expense', category: 'healthcare', date: '2025-08-10' },
                { description: 'Consulenza extra', amount: 600, type: 'income', category: 'business', date: '2025-08-25' },
                
                // Settembre
                { description: 'Stipendio Settembre', amount: 3500, type: 'income', category: 'salary', date: '2025-09-01' },
                { description: 'Ritorno a scuola', amount: -300, type: 'expense', category: 'education', date: '2025-09-05' },
                { description: 'Cena compleanno', amount: -120, type: 'expense', category: 'entertainment', date: '2025-09-20' },
                
                // Ottobre
                { description: 'Stipendio Ottobre', amount: 3500, type: 'income', category: 'salary', date: '2025-10-01' },
                { description: 'Bolletta gas', amount: -150, type: 'expense', category: 'utilities', date: '2025-10-05' },
                { description: 'Investimento crypto', amount: -500, type: 'expense', category: 'investment', date: '2025-10-15' },
                
                // Novembre
                { description: 'Stipendio Novembre', amount: 3500, type: 'income', category: 'salary', date: '2025-11-01' },
                { description: 'Shopping Black Friday', amount: -350, type: 'expense', category: 'shopping', date: '2025-11-25' },
                { description: 'Dividendi azioni', amount: 180, type: 'income', category: 'investment', date: '2025-11-30' },
                
                // Dicembre
                { description: 'Stipendio Dicembre', amount: 3500, type: 'income', category: 'salary', date: '2025-12-01' },
                { description: 'Regali di Natale', amount: -600, type: 'expense', category: 'shopping', date: '2025-12-15' },
                { description: 'Cena Capodanno', amount: -150, type: 'expense', category: 'entertainment', date: '2025-12-31' },
                { description: 'Bonus 13esima', amount: 2000, type: 'income', category: 'salary', date: '2025-12-31' }
            ];

            sampleTransactions.forEach(sample => {
                const transaction = {
                    id: nextId++,
                    description: sample.description,
                    amount: sample.amount,
                    type: sample.type,
                    category: sample.category,
                    date: sample.date,
                    timestamp: new Date().toISOString()
                };
                transactions.push(transaction);
            });

            updateAll();
            saveToLocalStorage();
            alert('Dati di esempio aggiunti con successo! (' + sampleTransactions.length + ' transazioni)');
        }

        // Initialize on DOM ready
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
            
            // Load saved data
            loadFromLocalStorage();

            // Setup period buttons
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentPeriod = this.dataset.period;
                    updateMetrics();
                });
            });

            // Setup file input for loading data
            document.getElementById('fileInput').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            transactions = data.transactions || [];
                            nextId = data.nextId || 1;
                            updateAll();
                            saveToLocalStorage();
                            alert('Data loaded successfully!');
                        } catch (error) {
                            alert('Error loading file: Invalid format');
                        }
                    };
                    reader.readAsText(file);
                }
            });

            // Initialize charts and update display
            initCharts();
            updateAll();
        });
    </script>
</body>
</html>